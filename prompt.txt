# Beertracker Code Style Guide

This document outlines the coding style and conventions used in the Beertracker
project, a Perl-based web application for tracking beer consumption.

## General Principles
- Write clean, readable, maintainable code
- Use meaningful variable and function names
- Include comments for complex logic
- Follow Perl best practices

## Dialog
- Always state first what you are about to do, before doing it

## File Structure
- Each module is in a separate .pm file in the code/ directory
- Main CGI script is index.cgi
- Use package declarations at the top of each module
- End modules with "1;" to indicate successful loading

## Language Features
- use strict;
- use warnings;
- use feature 'unicode_strings';
- use utf8;  # Source code and string literals are utf-8
- use open ':encoding(UTF-8)'; for file handling
- binmode STDOUT, ":utf8"; for output

## Code Structure
- Functions start with "sub function_name {"
- Use "my $c = shift;" for context object
- Return values explicitly where needed
- Use early returns for error conditions
- Functions end with "} # function_name"

## Variables and Naming
- Use lowercase with underscores: $variable_name
- Use descriptive names: $beer_list, $location_id
- Context object is $c
- Database handle is $c->{dbh}
- CGI object is $c->{cgi}

## Database Operations
- Use prepared statements: my $sth = $c->{dbh}->prepare($sql);
- Execute with parameters: $sth->execute(@values);
- Fetch results: my $rec = $sth->fetchrow_hashref;
- index.cgi uses a transaction for any POST request, rolling back in case of errors
- Foreign key constraints are enforced
- Use helpers in brews.pm etc, and esp db.pm where possible

## HTML Generation
- Use print qq{<html>...}; for HTML output
- Escape special characters appropriately
- Use CSS classes and inline styles as needed
- Generate forms with method="POST" for data modification

## JavaScript Integration
- Use <script> tags for client-side logic
- Inline JavaScript for simple interactions
- Use event handlers like onclick
- Most javascript should be in separate files under static/

## Error Handling
- Use util::error("message") for fatal errors
- Log to STDERR with print STDERR "message\n";
- More logging if $c->{devversion}
- Check return values and handle failures

## SQL Style
- Use uppercase for keywords: SELECT, INSERT, UPDATE
- Use placeholders (?) for parameters
- Join tables explicitly
- Use meaningful table aliases

## Comments
- Use # for single-line comments
- Use # TODO for future improvements
- Document function purposes
- Explain complex algorithms

## Control Structures
- Use foreach for loops: foreach my $item (@list)
- Use if/elsif/else for conditionals
- Use early returns to reduce nesting
- Use next/last for loop control

## Regular Expressions
- Use =~ for matching
- Use capturing groups when needed
- Prefer simple patterns over complex ones

## String Handling
- Use double quotes for interpolation: "Hello $name"
- Use qq{} for multi-line strings
- Handle UTF-8 encoding properly

## Arrays and Hashes
- Use -> for hash access: $hash->{key}
- Use @ for array operations
- Use scalar() for counting: scalar(@array)

## File Operations
- Use open with lexical filehandles: open my $fh, ">$file"
- Check open success: or util::error( "Could not open $file: $!"). 
- Close filehandles explicitly

## External Commands
- Use backticks for command execution: my $output = `command`
- Check $? for success
- Use timeout for web scraping

## JSON Handling
- Use JSON module: JSON->new->utf8->decode($json)
- Pretty-print for debugging: ->pretty->encode($data)

## CGI Parameters
- Use util::param($c, "name") for getting parameters
- Validate and sanitize input
- Handle missing parameters gracefully

## Logging
- Use STDERR for server-side logging
- Include timestamps when relevant
- Log important operations and errors

## Testing
- Test syntax with perl -c
- Test functionality manually
- Check database integrity after changes

## Version Control
- Commit logical units of work
- Include descriptive commit messages
- Keep history clean and meaningful

